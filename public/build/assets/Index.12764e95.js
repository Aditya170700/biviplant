import{h as u,D as N,K as r,O as b,J as x,V as y,c as T,w as V,o,a as e,f as l,l as w,k as D,t as d,j as _,u as k,F as C,e as F,E as I}from"./app.d328064a.js";import{L}from"./App.cc81f6db.js";const M={class:"row"},O={class:"col-md-12"},U={class:"card",id:"chat3",style:{"border-radius":"15px"}},H={class:"card-body"},S={class:"row"},$={class:"col-md-6 col-lg-5 col-xl-4 mb-4 mb-md-0"},J={class:"p-3"},K=e("div",{class:"input-group rounded mb-3 shadow-sm"},[e("input",{type:"search",class:"form-control rounded",placeholder:"Cari","aria-label":"Search","aria-describedby":"search-addon"}),e("span",{class:"input-group-text border-0",id:"search-addon"},[e("i",{class:"fas fa-search"})])],-1),R={"data-mdb-perfect-scrollbar":"true",style:{position:"relative",height:"400px",overflow:"scroll"}},q={class:"list-unstyled mb-0"},z=["onClick"],A={class:"d-flex flex-row"},G=["src"],P=e("span",{class:"badge bg-success badge-dot"},null,-1),Q={class:"pt-1"},W={class:"fw-bold mb-0"},X={key:0,class:"fa-solid fa-circle-dot",style:{color:"green"}},Y={class:"small text-muted"},Z={key:0,class:"pt-1"},ee={class:"badge bg-danger rounded-pill float-end"},se={class:"col-md-6 col-lg-7 col-xl-8"},te={key:0,class:"input-group rounded mb-3 px-2 py-2 shadow-sm"},ae={class:"d-flex flex-row"},oe=["src"],le=e("span",{class:"badge bg-success badge-dot"},null,-1),de={class:"pt-1"},ne={class:"fw-bold mb-0"},ce={class:"small text-muted"},ie={class:"pt-3 pe-3 chat-room","data-mdb-perfect-scrollbar":"true",style:{position:"relative",height:"400px",overflow:"scroll"}},re={key:0,class:"d-flex flex-row justify-content-start"},ue={class:"small p-2 ms-3 mb-1 rounded-3",style:{"background-color":"#f5f6f7"}},_e={class:"small ms-3 mb-3 rounded-3 text-muted float-end"},me={key:1,class:"d-flex flex-row justify-content-end"},he={class:"small p-2 me-3 mb-1 rounded-3",style:{"background-color":"#f5f6f7"}},pe={class:"small me-3 mb-3 rounded-3 text-muted"},fe={key:1,class:"text-muted d-flex justify-content-start align-items-center pe-3 pt-3 mt-2"},ve=e("a",{class:"ms-1 text-muted",href:"#!"},[e("i",{class:"fas fa-paperclip"})],-1),ge=e("i",{class:"fas fa-paper-plane"},null,-1),be=[ge],ke={__name:"Index",props:{user:Object,customers:Object},setup(j){const m=j,c=u(""),i=N({}),n=u({});let h=u(m.customers.data),p=u([]);r.on("message",t=>{var a;(a=n.value)!=null&&a.id&&(p.value.push(t),b(()=>{window.document.getElementsByClassName("chat-room")[0].scrollTo(0,window.document.getElementsByClassName("chat-room")[0].scrollHeight)}))}),r.on("notif-chat-admin",t=>{f()}),r.on("user-leave",()=>{f()}),r.on("user-join",()=>{f()});function B(){if(c.value!=""){let t=i.data.sender.id!=m.user.id?i.data.sender:i.data.receiver;n.value=t,r.emit("message-to-customer",{user_id:m.user.id,message:c.value,conversation_id:i.data.id,to_user_id:t.id}),c.value="",g(t)}}function f(){x.get(route("admin.chat.customers")).then(t=>{h.value=t.data.data}).catch(t=>{y("failed sync customers!")})}function g(t){x.get(route("admin.chat.show",{id:t.id})).then(a=>{n.value=t,i.data=a.data,p.value=a.data.messages,E(t),b(()=>{window.document.getElementsByClassName("chat-room")[0].scrollTo(0,window.document.getElementsByClassName("chat-room")[0].scrollHeight)})}).catch(a=>{y("something went wrooongg!")})}function E(t){var a;(a=h.value)==null||a.map(s=>s.id==t.id?(t.unread_messages=[],t):s)}return(t,a)=>(o(),T(L,{title:"Chat"},{default:V(()=>[e("div",M,[e("div",O,[e("div",U,[e("div",H,[e("div",S,[e("div",$,[e("div",J,[K,e("div",R,[e("ul",q,[(o(!0),l(C,null,w(k(h),(s,v)=>(o(),l("li",{class:"p-2 border-bottom",key:v},[e("a",{href:"#",class:"d-flex justify-content-between",onClick:xe=>g(s)},[e("div",A,[e("div",null,[e("img",{src:s.profile_photo_path_url,alt:"avatar",class:"d-flex align-self-center me-3",width:"50"},null,8,G),P]),e("div",Q,[e("p",W,[D(d(s.name)+" ",1),s.is_online==1?(o(),l("i",X)):_("",!0)]),e("p",Y,d(s.email),1)])]),s.unread_messages.length>0?(o(),l("div",Z,[e("span",ee,d(s.unread_messages.length),1)])):_("",!0)],8,z)]))),128))])])])]),e("div",se,[n.value.id?(o(),l("div",te,[e("div",ae,[e("div",null,[e("img",{src:n.value.profile_photo_path_url,alt:"avatar",class:"d-flex align-self-center me-3",width:"50"},null,8,oe),le]),e("div",de,[e("p",ne,d(n.value.name),1),e("p",ce,d(n.value.email),1)])])])):_("",!0),e("div",ie,[(o(!0),l(C,null,w(k(p),(s,v)=>(o(),l("div",{key:v},[s.user.is_admin?(o(),l("div",me,[e("div",null,[e("p",he,d(s.message),1),e("p",pe,d(s.date_time_formated),1)])])):(o(),l("div",re,[e("div",null,[e("p",ue,d(s.message),1),e("p",_e,d(s.date_time_formated),1)])]))]))),128))]),n.value.id?(o(),l("div",fe,[F(e("textarea",{type:"text","onUpdate:modelValue":a[0]||(a[0]=s=>c.value=s),class:"form-control form-control-lg",id:"exampleFormControlInput2",placeholder:"Tulis pesan"},null,512),[[I,c.value]]),ve,e("a",{class:"ms-3",href:"#!",onClick:a[1]||(a[1]=s=>B())},be)])):_("",!0)])])])])])])]),_:1}))}};export{ke as default};
