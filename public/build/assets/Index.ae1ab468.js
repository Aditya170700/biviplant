import{h as u,D as N,K as r,P as b,M as T,J as x,W as y,c as $,w as M,o as a,a as e,f as l,l as w,k as P,t as n,j as _,u as k,F as C,e as V,E as D}from"./app.7cdc33b8.js";import{L as F}from"./App.ea36ec42.js";const I={class:"row"},L={class:"col-md-12"},S={class:"card",id:"chat3",style:{"border-radius":"15px"}},U={class:"card-body"},H={class:"row"},O={class:"col-md-6 col-lg-5 col-xl-4 mb-4 mb-md-0"},J={class:"p-3"},K=e("div",{class:"input-group rounded mb-3 shadow-sm"},[e("input",{type:"search",class:"form-control rounded",placeholder:"Cari","aria-label":"Search","aria-describedby":"search-addon"}),e("span",{class:"input-group-text border-0",id:"search-addon"},[e("i",{class:"fas fa-search"})])],-1),R={"data-mdb-perfect-scrollbar":"true",style:{position:"relative",height:"400px",overflow:"scroll"}},W={class:"list-unstyled mb-0"},q=["onClick"],z={class:"d-flex flex-row"},A=["src"],G=e("span",{class:"badge bg-success badge-dot"},null,-1),Q={class:"pt-1"},X={class:"fw-bold mb-0"},Y={key:0,class:"fa-solid fa-circle-dot",style:{color:"green"}},Z={class:"small text-muted"},ee={key:0,class:"pt-1"},se={class:"badge bg-danger rounded-pill float-end"},te={class:"col-md-6 col-lg-7 col-xl-8"},oe={key:0,class:"input-group rounded mb-3 px-2 py-2 shadow-sm"},ae={class:"d-flex flex-row"},le=["src"],de=e("span",{class:"badge bg-success badge-dot"},null,-1),ne={class:"pt-1"},ce={class:"fw-bold mb-0"},ie={class:"small text-muted"},re={class:"pt-3 pe-3 chat-room","data-mdb-perfect-scrollbar":"true",style:{position:"relative",height:"400px",overflow:"scroll"}},ue={key:0,class:"d-flex flex-row justify-content-start"},_e={class:"small p-2 ms-3 mb-1 rounded-3",style:{"background-color":"#f5f6f7"}},me={class:"small ms-3 mb-3 rounded-3 text-muted float-end"},he={key:1,class:"d-flex flex-row justify-content-end"},pe={class:"small p-2 me-3 mb-1 rounded-3",style:{"background-color":"#f5f6f7"}},fe={class:"small me-3 mb-3 rounded-3 text-muted"},ve={key:1,class:"text-muted d-flex justify-content-start align-items-center pe-3 pt-3 mt-2"},ge=e("a",{class:"ms-1 text-muted",href:"#!"},[e("i",{class:"fas fa-paperclip"})],-1),be=e("i",{class:"fas fa-paper-plane"},null,-1),xe=[be],Ce={__name:"Index",props:{user:Object,customers:Object},setup(j){const m=j,i=u(""),c=N({}),d=u({});let h=u(m.customers.data),p=u([]);r.on("message",s=>{var o,t;console.log(c,s),((o=d.value)==null?void 0:o.id)&&((t=d.value)==null?void 0:t.id)==s.user.id&&(p.value.push(s),b(()=>{window.document.getElementsByClassName("chat-room")[0].scrollTo(0,window.document.getElementsByClassName("chat-room")[0].scrollHeight)}))}),r.on("notif-chat-admin",s=>{console.log(`Pesan baru dari ${s.name}.`),alert(`Pesan baru dari ${s.name}.`),T(`Pesan baru dari ${s.name}.`),f()}),r.on("user-leave",()=>{f()}),r.on("user-join",()=>{f()});function B(){if(i.value!=""){let s=c.data.sender.id!=m.user.id?c.data.sender:c.data.receiver;d.value=s,r.emit("message-to-customer",{user_id:m.user.id,message:i.value,conversation_id:c.data.id,to_user_id:s.id}),i.value="",g(s)}}function f(){x.get(route("admin.chat.customers")).then(s=>{h.value=s.data.data}).catch(s=>{y("failed sync customers!")})}function g(s){x.get(route("admin.chat.show",{id:s.id})).then(o=>{d.value=s,c.data=o.data,p.value=o.data.messages,E(s),b(()=>{window.document.getElementsByClassName("chat-room")[0].scrollTo(0,window.document.getElementsByClassName("chat-room")[0].scrollHeight)})}).catch(o=>{y("something went wrooongg!")})}function E(s){var o;(o=h.value)==null||o.map(t=>t.id==s.id?(s.unread_messages=[],s):t)}return(s,o)=>(a(),$(F,{title:"Chat"},{default:M(()=>[e("div",I,[e("div",L,[e("div",S,[e("div",U,[e("div",H,[e("div",O,[e("div",J,[K,e("div",R,[e("ul",W,[(a(!0),l(C,null,w(k(h),(t,v)=>(a(),l("li",{class:"p-2 border-bottom",key:v},[e("a",{href:"#",class:"d-flex justify-content-between",onClick:ye=>g(t)},[e("div",z,[e("div",null,[e("img",{src:t.profile_photo_path_url,alt:"avatar",class:"d-flex align-self-center me-3",width:"50"},null,8,A),G]),e("div",Q,[e("p",X,[P(n(t.name)+" ",1),t.is_online==1?(a(),l("i",Y)):_("",!0)]),e("p",Z,n(t.email),1)])]),t.unread_messages.length>0?(a(),l("div",ee,[e("span",se,n(t.unread_messages.length),1)])):_("",!0)],8,q)]))),128))])])])]),e("div",te,[d.value.id?(a(),l("div",oe,[e("div",ae,[e("div",null,[e("img",{src:d.value.profile_photo_path_url,alt:"avatar",class:"d-flex align-self-center me-3",width:"50"},null,8,le),de]),e("div",ne,[e("p",ce,n(d.value.name),1),e("p",ie,n(d.value.email),1)])])])):_("",!0),e("div",re,[(a(!0),l(C,null,w(k(p),(t,v)=>(a(),l("div",{key:v},[t.user.is_admin?(a(),l("div",he,[e("div",null,[e("p",pe,n(t.message),1),e("p",fe,n(t.date_time_formated),1)])])):(a(),l("div",ue,[e("div",null,[e("p",_e,n(t.message),1),e("p",me,n(t.date_time_formated),1)])]))]))),128))]),d.value.id?(a(),l("div",ve,[V(e("textarea",{type:"text","onUpdate:modelValue":o[0]||(o[0]=t=>i.value=t),class:"form-control form-control-lg",id:"exampleFormControlInput2",placeholder:"Tulis pesan"},null,512),[[D,i.value]]),ge,e("a",{class:"ms-3",href:"#!",onClick:o[1]||(o[1]=t=>B())},xe)])):_("",!0)])])])])])])]),_:1}))}};export{Ce as default};
